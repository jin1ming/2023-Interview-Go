# Galaxy-Flow 系统设计分析

基于代码目录结构和关键文件内容，`galaxy-flow` 是一个深度集成 **飞书 (Feishu)** 生态的企业级项目管理与效能分析系统。它采用了 **Go 后端 + 飞书小程序前端** 的架构。

## 1. 系统架构概览

*   **前端 (App)**:
    *   **技术栈**: 字节跳动/飞书小程序 (特征文件: `.ttss`, `project.config.json`)。
    *   **定位**: 移动端优先的办公入口，方便员工在飞书工作台中直接填报工时、查看报表。
*   **后端 (API)**:
    *   **技术栈**: Golang (Gin + Xorm)，架构风格与 `Carina` 和 `Motion` 保持高度一致。
    *   **定位**: 业务逻辑中心，负责数据聚合、报表生成以及与飞书开放平台的交互。

## 2. 核心模块设计

### A. 深度飞书集成 (Feishu Integration)
在 `api/client/feishu` 和业务逻辑中，系统通过适配器模式深度绑定了飞书能力：
*   **组织架构同步**: `user.go` 和 `department.go` 负责同步飞书通讯录，利用飞书作为唯一的身份源 (Identity Source)，避免了维护两套用户体系。
*   **审批流对接**: `approval.go` 和 `oa.go` 实现了审批业务。这通常涉及：
    *   发起审批：在小程序端发起项目立项或工时审批。
    *   状态回调：接收飞书审批中心的 Webhook 回调，更新本地数据库状态。

### B. 项目与效能管理 (Project & Efficiency)
这是系统的核心业务领域：
*   **多维度报表**: `weekly_report.go` (周报) 和 `monthly_report.go` (月报) 是系统的核心产出。系统不仅是简单的 CRUD，还包含了自动化的数据聚合逻辑（Cron Jobs），用于统计工时投入、项目进度等。
*   **工时管理**: `work_time.go` 实现工时填报。结合 `project.go`，可以计算出每个项目的"人力成本"和"投入产出比"。

### C. 统一的服务依赖管理 (Supplier Pattern)
与你其他项目（Carina, Motion）一脉相承，该项目在 `api/service/system/supplier.go` 中使用了 **Supplier 模式**：
*   **解耦**: `ServiceSupplier` 接口定义了服务间的依赖契约。
*   **容器化管理**: `SetUp()` 方法集中完成了服务的初始化和依赖注入，使得复杂的业务依赖（如：周报服务依赖项目服务和用户服务）变得清晰可控。

## 3. 优秀设计总结

1.  **生态位选择 (Ecosystem Native)**:
    *   没有选择开发独立的 Web 后台，而是直接做成飞书小程序。这利用了飞书的"免登"（SSO）和"消息触达"能力，极大降低了员工的使用门槛。
2.  **标准化架构 (Standardization)**:
    *   复用了成熟的 Go 后端脚手架（Metrics 监控、Cron 调度、优雅停机、统一配置管理）。这意味着团队在不同项目（Carina/Motion/Galaxy-Flow）之间切换维护的成本极低。
3.  **数据驱动 (Data-Driven)**:
    *   从 `dashboard.go` 和各种 Report 服务可以看出，系统非常重视数据的可视化和统计，旨在为管理层提供决策依据（如项目人力分布、部门效能统计）。

## 4. 总结

**Galaxy-Flow** 是一个典型的 **B2E (Business to Employee)** 内部效能工具。它的设计亮点在于**"借力"**——借飞书之力解决基础的用户和通知问题，从而集中精力处理"项目管理"和"效能统计"这两个核心且复杂的业务域。
