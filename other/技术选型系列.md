- **为什么要operator**

  为了拓展k8s的声明式API，通过crud使整个分布式应用运行在用户期望的状态。

  operator = crd + controller + 中间件运维。

  crd即自定义 API 资源

  使用者往往需要创建一个名为operator的控制器 、然后定义一个crd，然后operator就会创建中间件到你期望的状态。之后也再也不需要运维人员了(理想条件下)，因为operator能实现全部自动化的运维工作(副本控制、网络管理等等)，只要你定义一个你期望的状态(yaml)。

- **为什么用docker**

  1. 最大优势：容器虚拟化，快速分发和部署

     在云时代，开发者创建的应用必须要能够很方便的在网络上传播，也就是说应用必须脱离底层物理硬件的限制；同时必须是“在任何时间任何地点”可获取的。

  2. devops

     - 更快的交付和部署
     - 更高效的资源利用
     - 更轻松地迁移和拓展
     - 更简单的更新管理

  3. docker与虚拟机比较

     启动速度、性能、内存代价、硬盘使用、运行密度、隔离性、迁移性

- **为什么用k8s，不用docker？**

  0、声明式API的编排工具，整个系统去维护预期的状态。

  1、故障迁移：当某一个node节点关机或挂掉后，node节点上的服务会自动转移到另一个node节点上，这个过程所有服务不中断。这是docker或普通云主机是不能做到的

  2、资源调度：当node节点上的cpu、内存不够用的时候，可以扩充node节点，新建的pod就会被kube-schedule调度到新扩充的node节点上

  3、资源隔离：创建开发、运维、测试三个命名空间，切换上下文后，开发人员就只能看到开发命名空间的所有pod，看不到运维命名空间的pod，这样就不会造成影响，互不干扰

       传统的主机或只有docker环境中，登录进去就会看到所有的服务或者容器

  4、因为采用docker容器，进程之间互不影响，

  5、安全：不同角色有不同的权限，查看pod、删除pod等操作；RBAC认证增加了k8s的安全

   快速精准地部署应用程序，限制硬件用量仅为所需资源
  **Kubernetes 的优势**

    可移动: 公有云、私有云、混合云、多态云
    可扩展: 模块化、插件化、可挂载、可组合
    自修复: 自动部署、自动重启、自动复制、自动伸缩

- **为什么用prometheus，不用zabbix？**

  针对 Zabbix 总结一下，有以下的优点：

  1、监控模版可以包含多个指标，在不涉及自定义采集脚本等其他方式的情况下，使用SNMP、Zabbix Agent 的情况下可以做到开箱即用；

  2、指标和触发器（Zabbix的告警规则叫触发器）的关联交互挺好用；

  3、宏和宏变量的使用可以大大的提高告警的便捷性，基本可以做到每个label 不同的阈值；

  4、Zabbix 的指标采集挺丰富的，包括采集间隔，是否要一直采集还是每天固定时间段来采集；

  5、Zabbix 的管理页面，这个不愧是企业级软件，Zabbix 很大一部分的优势是靠它来体现的。

  说完了优点来看看缺点：

  1、Zabbix 架构原生是单点，没有集群方案，官方推荐的是使用keepalived 来进行3个点的负载均衡，这个方案在现在来说还是有很大的优化空间的。

  2、Zabbix 的数据存储使用关系型数据库，在 Zabbix 刚发布的时候，这个没的选择，但放在现在这是个很大的问题，当指标数量增加以后，数据的存储空间、查询时间都变成了一个恐怖的事情。当前使用了6TiB的空间来存储了每帧80万条数据，采集间隔一分钟，详细数据1个月，历史数据大概1年半的数据，Prometheus 存储比这个节省多了。当然zabbix 也可以支持更大的数据收集规模，只是不知道资源会按什么比例增长。

  3、升级复杂，体验了4.4.0升级到4.4.10以后，升级太麻烦，使用Zabbix 你的团队最好配置一个DBA 来处理各种问题。

  4、Zabbix 和 Grafana 的结合不太好，语句写起来挺生硬的，也能用，但是不如Prometheus 灵活。

  对于prometheus 这个月我也做了例行升级，大概花了一个小时左右，我升级完了十多个实例，配套的Thanos 和存储数据的Minio。和Zabbix 相比，这太让人舒服了。

  Prometheus 具备以下优点：

  1、结构简单，但是可以水平扩展，通过和thanos 结合可以做到无缝的水平扩展。不喜欢thanos 也可以使用自带的联邦功能进行扩展，Prometheus 的思想就是：我尽量简单但是好用，剩下的功能尽管放给其他人做

  2、采用时序数据库，大大的节省了存储空间，并且提升了查询效率。我使用3TiB 的空间存储了每帧300万条数据，30秒采集一次，大约有120万条数据是15秒采集一次，详细数据存2个月，5分钟降准数据存半年，一小时降准数据存一年，而且我还不需要DBA 参与。

  3、采集配置简单，简单配置以后就可以收取丰富的指标，不用自己一个指标一个指标的添加。

  4、原生支持收集很多服务暴露的监控数据，Zabbix 很难收集应用自身提供的监控数据。

  对于Prometheus 的缺点，

  1、当前告警规则无法快捷的支持每个label 一个阈值，要么统一阈值，要么一个label 一条规则，量大了以后真的不好管理。

  其他感觉和zabbix 比起来没啥缺点了。

  另外有一个不同点就是，当采集内容较多的时候会出现一个机器上有多个 Agent 的问题。对于这个方面来说，Zabbix 只有一个 Agent ，但是很多内容需要自己编写采集脚本，Agent 还是比自己编写脚本的可靠性更高一些。另外对于单节点多 Agent 来说，Prometheus 也有对应的解决方案。